<!DOCTYPE html>
<html>
  <head>
    <title>Questionnaire</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script> 
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.3"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />

  </head>
  <body></body>
  <script>
    const jsPsych = initJsPsych();

    let correct_count = 0;
    let question_number = 0;
    let missedQuestions = [];   // stores missed questions across all pages
    let rtData = {};            // stores response time per question
    let last_response_time = performance.now();

    const intro = {
        type: jsPsychSurveyMultiChoice,
        premable: `
        <h2>Welcome to the Experiment</h2>
        <p>You will complete 4 blocks of 40 MCQs</p>
        <p>blah blah</p> 
        `,
        questions: [
            {
                prompt: "Ready to begin?",
                options: ["Yes"],
                required: true,
                name: "start"
            }
        ]
    }

    const page1_qs = {
        type: jsPsychSurveyMultiChoice,
        questions: [
            {
                prompt: "What is 1 + 2?", 
                name: 'NumberEasy', 
                options: ['1', '2', '3', '4'], 
            }, 
            {
                prompt: "What is the capital city of France?", 
                name: 'FranceCapital', 
                options: ['London', 'Bulgaria', 'Paris', 'George'], 
            }
        ],
        on_start: function(trial) {
        trial.custom_start_time = last_response_time;
      },
        on_finish: data => {
        const resp = data.response;
        if (resp.NumberEasy === "3") correct_count++;
        if (resp.FranceCapital === "Paris") correct_count++;
        data.rt_from_prev = performance.now() - this.custom_start_time;
        last_response_time = performance.now();
      }
    };

    const page2_qs = {
        type: jsPsychSurveyMultiChoice,
        questions: [
            {
                prompt: "Huh?", 
                name: 'HouseHuh', 
                options: ['Intentionally dense?', 'Cucumber', 'Eggplant', 'Corn'], 
            }, 
            {
                prompt: "Who is the best YouTuber?", 
                name: 'BestYTber', 
                options: ['IHasCupquake', 'Banana', 'Orange', 'Grape'], 
            }
        ],
        on_start: function(trial) {
        trial.custom_start_time = last_response_time;
      },
        on_finish: data => {
        const resp = data.response;
        if (resp.HouseHuh === "Intentionally dense?") correct_count++;
        if (resp.BestYTber === "IHasCupquake") correct_count++; 
        data.rt_from_prev = performance.now() - this.custom_start_time;
        last_response_time = performance.now();
      }
    };

    const page3_qs = {
        type: jsPsychSurveyMultiChoice,
        questions: [
            {
                prompt: "AHHHH?", 
                name: 'Confusion', 
                options: ['This one', 'Cucumber', 'Eggplant', 'Corn'], 
            }, 
            {
                prompt: "RAAAA?", 
                name: 'Confusion2', 
                options: ['Honk', 'Banana', 'Orange', 'Grape'], 
            }
        ],
        on_start: function(trial) {
        trial.custom_start_time = last_response_time;
      },
        on_finish: data => {
        const resp = data.response;
        if (resp.Confusion === "This one") correct_count++;
        if (resp.Confusion2 === "Honk") correct_count++;
        data.rt_from_prev = performance.now() - this.custom_start_time;
        last_response_time = performance.now();
      }
    };

    const debrief = {
        type: jsPsychSurveyMultiChoice,
        preamble:` <h2>Debrief</h2> `,
        questions: [
        {
          prompt: "Thank you for participating!",
          options: ["Finish"],
          name: "end",
          required: true
        }
      ]
    };

    const timeline = [intro, page1_qs, page2_qs, page3_qs, debrief];

    jsPsych.run(timeline);

    jsPsych.onFinish(() => {
  jsPsych.data.get().localSave('csv', 'experiment_data.csv');
});

  </script>
</html>